<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style type="text/css">
            v\:* {
                behavior:url(#default#VML);
            }

            #download {
            font-size:20px;
            }

    </style>

    <!-- Make the document body take up the full screen -->
    <style type="text/css">
            html, body {width: 100%; height: 100%}
            body {margin-top: 0px; margin-right: 0px; margin-left: 0px; margin-bottom: 0px}

    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css"/>

    <title>View trace {{filename}}</title>
    <script type="text/javascript"
            src="//ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js">
    </script>

    <script type="text/javascript">


$(function() {
    $('#upload-file-btn').click(function() {
        var form_data = new FormData($('#upload-file')[0]);
        $.ajax({
            type: 'POST',
            url: '/uploadajax',
            data: form_data,
            contentType: false,
            cache: false,
            processData: false,
            success: function(data) {
                console.log('Success!');
                console.log(data);

                document.getElementById('mapContainer').innerHTML = "<div id='map' style='width: 100%; height: 100%;'></div>";

   var map = L.map('map');
L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>'}).addTo(map);



                var gpx = "/gpx/" + data["filename"]; // URL to your GPX file or the GPX itself
                new L.GPX(gpx, {async: true}).on('loaded', function(e) {
                  map.fitBounds(e.target.getBounds());
                }).addTo(map);

                    $("#downloadGPX").attr("href", "/download/" + data["filename"]);
                    $("#downloadGPX").css("display", "inline");

            },
        });
    });
});

    </script>

</head>
<body>


<div id="controls" style="width:100%; height:50px; position:absolute; top:0px; left:0px">
    <div id="upload" style="width:60%; float: left">
        <form id="upload-file" method="post" enctype="multipart/form-data">
            <fieldset>
                <label for="file">Select a file</label>
                <input name="file" id="file" type="file">
            </fieldset>
            <fieldset>
                <button id="upload-file-btn" type="button">Upload</button>
            </fieldset>
        </form>
    </div>
    <div id="download" style="width:30%; float: right">

        <a id="downloadGPX" style="display:none">Download GPX</a>
    </div>

</div>


<div id="mapContainer" style="width: 100%; height: calc(90% - 50px); position:absolute; bottom:0px"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.4.0/gpx.min.js"></script>

</body>
</html>